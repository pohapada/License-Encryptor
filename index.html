<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>License Encryptor</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.png" sizes="192x192" type="image/png">
  <link rel="apple-touch-icon" href="icon.png" sizes="192x192">

  <!-- Mobile UI meta -->
  <meta name="theme-color" content="#2563eb">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- CryptoJS (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root { --primary:#2563eb; --secondary:#10b981; --gray:#f3f4f6; --text:#1f2937; --card-bg:#ffffff; --shadow:rgba(0,0,0,0.05); }
    body.dark { --primary:#60a5fa; --secondary:#34d399; --gray:#1f2937; --text:#f3f4f6; --card-bg:#111827; --shadow:rgba(255,255,255,0.05); }
    * { box-sizing:border-box; margin:0; padding:0; }
    html,body{height:100%;}
    body {
      font-family:'Inter',sans-serif;
      background:var(--gray); color:var(--text);
      display:flex; align-items:center; justify-content:center;
      padding:1rem; transition:background .3s,color .3s;
    }
    .card {
      background:var(--card-bg); border-radius:1.5rem;
      box-shadow:0 10px 25px var(--shadow);
      width:100%; max-width:480px; padding:2rem;
      animation:fadeIn .4s ease-out;
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0)}}
    h1{display:flex;align-items:center;justify-content:center;font-size:1.8rem;font-weight:700;margin-bottom:1.5rem;color:var(--primary)}
    h1 img{width:1.5rem;height:1.5rem;margin-right:0.5rem}
    .form-group{margin-bottom:1rem}
    label{display:block;font-weight:600;margin-bottom:.5rem}
    input,select{
      width:100%;padding:.75rem 1rem;border:1px solid #d1d5db;border-radius:.75rem;
      background:#fff;font-size:1rem;transition:border-color .2s,background .3s;
    }
    body.dark input,body.dark select{background:#1e293b;color:#f3f4f6;border-color:#374151}
    input:focus,select:focus{border-color:var(--primary);outline:none}
    .btn-group{display:flex;flex-wrap:wrap;gap:.75rem;margin-top:1.25rem}
    button{flex:1 1 48%;padding:.75rem;border:none;border-radius:.75rem;font-weight:600;font-size:1rem;cursor:pointer;transition:transform .2s}
    button:hover{transform:translateY(-2px)}
    .btn-encrypt{background:var(--primary);color:#fff}
    .btn-decrypt{background:var(--secondary);color:#fff}
    .btn-dev{background:#9ca3af;color:#fff}
    .btn-copy{background:#6366f1;color:#fff;display:none}
    .dark-toggle,.lock-toggle{
      position:fixed;top:1rem;width:2.5rem;height:2.5rem;border:none;border-radius:50%;
      background:var(--secondary);color:#fff;display:flex;align-items:center;justify-content:center;
      cursor:pointer;box-shadow:0 2px 8px var(--shadow);transition:transform .2s;z-index:10;
    }
    .dark-toggle{right:1rem}
    .lock-toggle{right:4rem;display:none}
    pre{
      background:#f9fafb;padding:1rem;border-left:4px solid var(--primary);
      border-radius:.75rem;margin-top:1.5rem;font-size:.9rem;white-space:pre-wrap;
      color:var(--text);font-family:'Courier New',monospace;cursor:pointer;
    }
    body.dark pre{background:#1e293b}
    @media(max-width:480px){button{flex:1 1 100%}}
    /* Eye icon button reset */
    .eye-btn{position:absolute;top:50%;right:0.75rem;transform:translateY(-50%);background:none;border:none;padding:0;width:1.25rem;height:1.25rem;cursor:pointer;}
    .eye-btn svg{width:100%;height:100%;fill:var(--text);}
  </style>
</head>
<body>

  <button class="dark-toggle" onclick="toggleDarkMode()">üåì</button>
  <button class="lock-toggle" id="lockBtn" onclick="toggleLock()">üîí</button>

  <div class="card">
    <h1><img src="icon.png" alt="Logo">License Encryptor</h1>

    <div class="form-group">
      <label for="number">License ID</label>
      <input id="number" type="text" placeholder="e.g., 123456789">
    </div>

    <div class="form-group">
      <label for="duration">Duration</label>
      <select id="duration">
        <option value="1">1 Month</option>
        <option value="3">3 Months</option>
        <option value="6">6 Months</option>
        <option value="9">9 Months</option>
        <option value="12">12 Months</option>
      </select>
    </div>

    <div class="form-group">
      <label for="key">Encryption Key (16 chars)</label>
      <div style="position:relative;">
        <input id="key" type="password" maxlength="16" placeholder="16-character key" style="padding-right:2.5rem;" />
        <button class="eye-btn" id="toggleKeyVis" aria-label="Show or hide key">
          <!-- eye open -->
          <svg id="eyeOpen" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5C21.27 7.61 17 4.5 12 4.5zm0 13c-3.04 0-5.5-2.46-5.5-5.5S8.96 6.5 12 6.5s5.5 2.46 5.5 5.5-2.46 5.5-5.5 5.5zm0-9a3.5 3.5 0 100 7 3.5 3.5 0 000-7z"/>
          </svg>
          <!-- eye closed -->
          <svg id="eyeClosed" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="display:none;">
            <path d="M12 6.5c2.89 0 5.33 1.71 6.5 4.25-1.17 2.54-3.61 4.25-6.5 4.25s-5.33-1.71-6.5-4.25C6.67 8.21 9.11 6.5 12 6.5m0-2c-3.91 0-7.23 2.24-8.94 5.5 1.71 3.26 5.03 5.5 8.94 5.5s7.23-2.24 8.94-5.5C19.23 6.74 15.91 4.5 12 4.5zM12 9a3 3 0 013 3c0 .34-.06.66-.17.96l3.54 3.54-1.41 1.41L12 14.41l-3.96 3.96-1.41-1.41L10.59 12l-3.96-3.96 1.41-1.41L12 9z"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="form-group" id="unixGroup" style="display:none;">
      <label for="manualUnix">Custom Unix Time (Dev Mode)</label>
      <input id="manualUnix" type="number" placeholder="Optional for testing">
    </div>

    <div class="btn-group">
      <button class="btn-encrypt" onclick="encrypt()">üîê Encrypt</button>
      <button class="btn-decrypt" onclick="decrypt()">üîì Decrypt</button>
      <button class="btn-dev" onclick="toggleDev()" id="btnDev">üõ†Ô∏è Dev Mode: OFF</button>
      <button class="btn-copy" onclick="copyRaw()" id="btnCopy">üìã Copy Raw</button>
    </div>

    <pre id="output">Click to copy for Telegram or Raw</pre>
  </div>

<script>
  let lastEncryptedRaw = '', lastEncryptedTelegram = '', lastMode = '';
  let isKeyLocked = false;

  // Register SW
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }

  // Dark mode
  function toggleDarkMode() {
    document.body.classList.toggle('dark');
    localStorage.setItem('dark', document.body.classList.contains('dark')?'1':'0');
  }
  if (localStorage.getItem('dark')==='1') document.body.classList.add('dark');

  // Dev & lock
  let devMode = false;
  function toggleDev() {
    devMode = !devMode;
    document.getElementById('unixGroup').style.display = devMode?'block':'none';
    const lockBtn = document.getElementById('lockBtn');
    lockBtn.style.display = devMode?'flex':'none';
    document.getElementById('btnDev').textContent = devMode?'üõ†Ô∏è Dev Mode: ON':'üõ†Ô∏è Dev Mode: OFF';
  }
  function toggleLock() {
    isKeyLocked = !isKeyLocked;
    const keyInput = document.getElementById('key');
    keyInput.disabled = isKeyLocked;
    document.getElementById('lockBtn').textContent = isKeyLocked?'üîì':'üîí';
  }

  // Eye toggle
  document.getElementById('toggleKeyVis').addEventListener('click',()=>{
    const ki = document.getElementById('key');
    const open = document.getElementById('eyeOpen');
    const closed = document.getElementById('eyeClosed');
    if(ki.type==='password'){
      ki.type='text';
      open.style.display='none';
      closed.style.display='block';
    } else {
      ki.type='password';
      open.style.display='block';
      closed.style.display='none';
    }
  });

  // Persist key in PWA
  if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
    const keyInput = document.getElementById('key');
    const stored = localStorage.getItem('cryptoKey');
    if (stored) keyInput.value = stored;
    keyInput.addEventListener('input', e => {
      if (!isKeyLocked) localStorage.setItem('cryptoKey', e.target.value);
    });
  }

  function padKey(k){ return CryptoJS.enc.Utf8.parse(k.padEnd(16,'\0').slice(0,16)); }

  function encrypt(){
    const num=document.getElementById('number').value.trim();
    const months=parseInt(document.getElementById('duration').value,10);
    const keyVal=document.getElementById('key').value.trim();
    const manualUnix=document.getElementById('manualUnix').value.trim();
    const outputEl=document.getElementById('output');
    const btnCopy=document.getElementById('btnCopy');
    if(!/^\d+$/.test(num)||keyVal.length!==16){
      btnCopy.style.display='none';
      return outputEl.textContent='‚ö†Ô∏è License ID must be numeric and the key must be exactly 16 characters.';
    }
    const ts=devMode&&manualUnix?parseInt(manualUnix,10):Math.floor(new Date().setMonth(new Date().getMonth()+months)/1000);
    const plaintext=`${num}|${ts}`;
    lastEncryptedRaw=CryptoJS.AES.encrypt(plaintext,padKey(keyVal),{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString();
    lastEncryptedTelegram='`'+lastEncryptedRaw+'`';
    lastMode='encrypt';
    outputEl.textContent=`Encrypted:\n${lastEncryptedRaw}\n\nUnix Time: ${ts}\nDate: ${new Date(ts*1000).toLocaleString()}`;
    btnCopy.style.display='inline-block';
  }

  function decrypt(){
    const encrypted=prompt('Paste encrypted Base64:');
    const keyVal=document.getElementById('key').value.trim();
    const outputEl=document.getElementById('output');
    const btnCopy=document.getElementById('btnCopy');
    btnCopy.style.display='none';
    if(!encrypted||keyVal.length!==16){
      return outputEl.textContent='‚ö†Ô∏è Missing encrypted text or key (16 chars).';
    }
    try{
      const [num,ts]=CryptoJS.AES.decrypt(encrypted,padKey(keyVal),{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Utf8).split('|');
      lastMode='decrypt';
      outputEl.textContent=`Decrypted:\nLicense ID: ${num}\n\nUnix Time: ${ts}\nDate: ${new Date(parseInt(ts,10)*1000).toLocaleString()}`;
    } catch {
      outputEl.textContent='‚ùå Decryption failed. Check your key and input.';
    }
  }

  async function copyRaw(){
    if(!lastEncryptedRaw) return;
    try{ await navigator.clipboard.writeText(lastEncryptedRaw); alert('‚úÖ Raw copied!'); }
    catch{ alert('‚ùå Copy failed.'); }
  }

  document.getElementById('output').addEventListener('click',async()=>{
    const txt=document.getElementById('output').textContent;
    try{
      if(lastMode==='encrypt'&&lastEncryptedTelegram){
        await navigator.clipboard.writeText(lastEncryptedTelegram);
        alert('‚úÖ Copied for Telegram!');
      } else if(lastMode==='decrypt'&&txt){
        await navigator.clipboard.writeText(txt);
        alert('‚úÖ Output copied!');
      }
    } catch { alert('‚ùå Copy failed.'); }
  });
</script>
</body>
</html>
